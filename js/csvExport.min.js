!function($){$.fn.extend({csvExport:function(options){this.defaultOptions={escapeContent:!0,title:"Exported_Table",beforeStart:function(){},onStringReady:function(){}};const settings=$.extend({},this.defaultOptions,options);return this.each(function(){const $this=$(this),real={x:0,y:0},toExpand={x:[],y:[]};let theString="";function deleteChecker(parent,pos){return parent[pos].toDo==parent[pos].done&&(parent.splice(pos,pos+1),!0)}function spanChecker(){let colspanHandler=!0;for(;colspanHandler;){let broken=!1,directions=["y","x"];for(let k=0;k<directions.length;k++){const direction=directions[k],other="y"==direction?"x":"y";for(let i=0;i<toExpand[direction].length;i++)if(deleteChecker(toExpand[direction],i)&&i>0&&i--,toExpand[direction].length>0&&real[other]==toExpand[direction][i].ori[other]&&real[direction]==toExpand[direction][i].ori[direction]+toExpand[direction][i].done){theString+='"",',toExpand[direction][i].done++,broken=!0,real.x++;break}}broken||(colspanHandler=!1)}}function contentCheckup(data){return data=data.replace(/\./g,","),settings.escapeContent?data.replace(/([\\"])/g,"\\$1"):data}function b64toBlob(b64Data,contentType,sliceSize){contentType=contentType||"",sliceSize=sliceSize||512;let byteCharacters=atob(b64Data),byteArrays=[],blob;for(let offset=0;offset<byteCharacters.length;offset+=sliceSize){let slice=byteCharacters.slice(offset,offset+sliceSize),byteNumbers=new Array(slice.length);for(let i=0;i<slice.length;i++)byteNumbers[i]=slice.charCodeAt(i);let byteArray=new Uint8Array(byteNumbers);byteArrays.push(byteArray)}return new Blob(byteArrays,{type:contentType})}settings.beforeStart.call(null,$this),$("tr",$this).each(function(){const currentTR=$(this);currentTR.children().each(function(){const currentTD=$(this);spanChecker(),currentTD.is("[colspan]")&&toExpand.x.push({ori:{x:real.x,y:real.y},toDo:+currentTD.attr("colspan"),done:1}),currentTD.is("[rowspan]")&&toExpand.y.push({ori:{x:real.x,y:real.y},toDo:+currentTD.attr("rowspan"),done:1});let currentCellString="",currentCellNodes=currentTD[0].childNodes;for(let i=0;i<currentCellNodes.length;i++)currentCellString+=(currentCellNodes[i].innerText||currentCellNodes[i].textContent.replace(/\s/g,"").length?currentCellNodes[i].textContent:"")+" ";currentCellString=contentCheckup(currentCellString).replace(/\s+/g," "),theString+='"'+currentCellString+'",',real.x++}),theString=theString.substring(0,theString.length-1),theString+="\r\n",real.x=0,real.y++}),settings.onStringReady.call(null,theString);const fileData=window.btoa(unescape(encodeURIComponent(theString))),title=settings.title+".csv";if(navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./)){const blobObject=b64toBlob(fileData);window.navigator.msSaveOrOpenBlob(blobObject,title)}else{const a=document.createElement("a");a.href="data:application/vnd.ms-excel;base64,"+fileData,a.download=title,a.click()}})}})}(jQuery);